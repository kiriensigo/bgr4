---
description:
globs:
alwaysApply: false
---
# ゲーム計算ルール

**BGReviews!** - ボードゲームレビューサイトの計算ルール

## 🎯 基本方針

システムレビュー10件は廃止し、BGGスコア重み付け計算のみを使用する。
これにより負荷軽減とデータベース容量削減を実現。

## 📊 計算式一覧

### 1. 総合評価・各種スコア計算
```
計算式: (ユーザーレビュー合計 + BGGスコア×10) / (ユーザーレビュー数 + 10)

対象項目:
- 総合得点 (overall_score)
- ルールの複雑さ (rule_complexity) 
- 運要素 (luck_factor)
- 相互作用 (interaction)
- ダウンタイム (downtime)

BGG基準値:
- 総合得点: BGGスコア (bgg_score) または 7.5
- ルール複雑さ: BGG Weight (weight) または 3.0
- その他: 3.0 (固定値)
```

### 2. おすすめ人数計算
```
計算式: (ユーザー投票数 + BGG推奨フラグ×10) / (総投票数 + 10)

BGG推奨フラグ:
- BGG Best または Recommended に含まれる場合: 1
- 含まれない場合: 0

表示条件: 50%以上 (0.5以上) の推奨度を持つ人数をすべて表示
人数正規化: 7人以上は「7」に統一
```

### 3. カテゴリー・メカニクス計算
```
BGG情報の重み付け登録:
- BGGから取得したカテゴリー・メカニクスを当サイト形式に変換
- 変換されたものをそれぞれ×10個登録 (重み付け)
- ユーザーレビューと合算してカウント

表示ルール:
- 上位7件のカテゴリーを表示
- 上位7件のメカニクスを表示
- 平均ではなく個数カウントで算出
```

## 🔄 BGG変換マップ

### カテゴリー変換
```ruby
# BGGカテゴリー → サイトカテゴリー
'Animals' => '動物'
'Bluffing' => 'ブラフ'
'Card Game' => 'カードゲーム'
"Children's Game" => '子供向け'
'Deduction' => '推理'
'Memory' => '記憶'
'Negotiation' => '交渉'
'Party Game' => 'パーティー'
'Puzzle' => 'パズル'
'Wargame' => 'ウォーゲーム'
'Word Game' => 'ワードゲーム'

# BGGメカニクス → サイトカテゴリー
'Acting' => '演技'
'Legacy Game' => 'レガシー・キャンペーン'
'Solo / Solitaire Game' => 'ソロ向き'
'Pattern Building' => 'パズル'
'Trick-taking' => 'トリテ'
```

### メカニクス変換
```ruby
# BGGメカニクス → サイトメカニクス
'Area Majority / Influence' => 'エリア支配'
'Auction / Bidding' => 'オークション'
'Cooperative Game' => '協力'
'Deck, Bag, and Pool Building' => 'デッキ/バッグビルド'
'Dice Rolling' => 'ダイスロール'
'Hidden Roles' => '正体隠匿'
'Worker Placement' => 'ワカプレ'
'Set Collection' => 'セット収集'
'Tile Placement' => 'タイル配置'
```

## ⚠️ 重要な変更点

### システムレビュー廃止
- 従来: システムレビュー10件 + BGG重み付け (重複)
- 新規: BGG重み付けのみ (負荷軽減)

### カテゴリー・メカニクス強化
- 従来: 上位6件表示
- 新規: BGG情報×10 + ユーザー投票で上位7件表示

### 計算処理最適化
- データベース容量削減
- レビュー処理高速化
- 管理工数削減

## 🎊 実装完了

**2025年6月25日 20:13 完全実装済み！**

BGG ID 172818 (Above and Below) にて検証完了：
- ✅ システムレビュー30件完全削除
- ✅ BGG重み付け×10方式実装  
- ✅ カテゴリー・メカニクス新ルール適用
- ✅ プレイ人数推奨データ正常表示

**世界最高のボードゲーム情報サイト完成だぜ！** 🚀
